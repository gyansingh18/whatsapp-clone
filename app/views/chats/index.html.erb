<div class="chat-container">
  <!-- Chat Sidebar -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Chats</h2>
      <%= link_to new_chat_path, class: "new-chat-btn", title: "New Chat" do %>
        <i class="fas fa-plus"></i>
      <% end %>
    </div>

    <!-- Online Users Section -->
    <% if @users.any? %>
      <div class="online-users">
        <div class="online-users-title">Online Users</div>
        <div class="online-users-list">
          <% @users.each do |user| %>
            <%= link_to chats_path(user_id: user.id), method: :post, class: "online-user" do %>
              <div class="online-user-avatar">
                <%= user.username.first.upcase %>
              </div>
              <div class="online-user-name"><%= user.username %></div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Chat List -->
    <div class="chat-list">
      <% if @chats.any? %>
        <% @chats.each do |chat| %>
          <%= link_to chat_path(chat), class: "chat-item #{'active' if params[:id] == chat.id.to_s}" do %>
            <div class="chat-avatar">
              <% if chat.chat_type == 'direct' %>
                <% other_user = chat.users.where.not(id: current_user.id).first %>
                <%= other_user&.username&.first&.upcase || '?' %>
              <% else %>
                <i class="fas fa-users"></i>
              <% end %>
            </div>
            <div class="chat-info">
              <div class="chat-name">
                <% if chat.chat_type == 'direct' %>
                  <% other_user = chat.users.where.not(id: current_user.id).first %>
                  <%= other_user&.username || 'Unknown User' %>
                <% else %>
                  <%= chat.name %>
                <% end %>
              </div>
              <% if chat.last_message %>
                <div class="chat-last-message">
                  <%= truncate(chat.last_message.content, length: 50) %>
                </div>
              <% else %>
                <div class="chat-last-message" style="color: #999; font-style: italic;">No messages yet</div>
              <% end %>
            </div>
            <% if chat.last_message %>
              <div class="chat-meta">
                <%= chat.last_message.created_at.strftime('%H:%M') %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <div style="padding: 20px; text-align: center; color: #666;">
          <i class="fas fa-comments" style="font-size: 2em; margin-bottom: 10px; color: #ddd;"></i>
          <p>No chats yet. Start a conversation!</p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-area">
    <div class="empty-chat">
      <i class="fab fa-whatsapp"></i>
      <h3>Welcome to WhatsApp Clone</h3>
      <p>Select a chat to start messaging or create a new conversation.</p>
      <%= link_to "Start New Chat", new_chat_path, class: "btn btn-primary", style: "margin-top: 20px;" %>
    </div>
  </div>
</div>
